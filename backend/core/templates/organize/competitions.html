{% extends "base.html" %}
{% load static %}
{% block title %}Danh sách cuộc thi{% endblock %}


{% block head_extra %}
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --bg: #0f172a;
      --card: #111827;
      --muted: #94a3b8;
      --txt: #e5e7eb;
      --brand: #f59e0b;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--txt);
      font-family: system-ui, Segoe UI, Roboto, Inter, Arial
    }

    .container {
      max-width: 960px;
      margin: 24px auto;
      padding: 0 16px
    }

    h1 {
      margin: 0 0 16px;
      font-size: 32px;
      font-weight: 800;
      margin: 0 0 16px;
    }

    .page-title {
      font-size: 32px !important;
      font-weight: 600 !important;
      line-height: 1.2;
      margin: 0 0 16px;
    }
/* Liquid glass card */
.card {
  position: relative;
  border-radius: 16px;
  padding: 16px;
  margin-bottom: 16px;

  background: linear-gradient( to bottom right, rgba(255,255,255,0.1), rgba(255,255,255,0.06) );
  border: 1px solid rgba(255,255,255,0.14);
  box-shadow:
    0 10px 30px rgba(0,0,0,0.35),
    inset 0 1px 0 rgba(255,255,255,0.08);

  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
}

.card::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  pointer-events: none;
  background:
    radial-gradient(120% 120% at -10% -20%, rgba(255,255,255,0.20), transparent 45%),
    radial-gradient(110% 110% at 120% -10%, rgba(255,255,255,0.12), transparent 45%);
  mix-blend-mode: screen;
  opacity: .7;
}


    .row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center
    }

    input[type=text],
    input[type=number] {
      background: #0b1220;
      color: var(--txt);
      border: 1px solid #243045;
      border-radius: 8px;
      padding: 8px 10px
    }

    .btn {
      background: #f4f1ecc6;
      color: #223382;
      border: none;
      border-radius: 14px;
      padding: 7px 14px;
      font-weight: 500;
      cursor: pointer;
      text-align: center;
      font-size: calc(var(--font-base) 4px);

      -webkit-backdrop-filter: blur(8px) saturate(130%);
      backdrop-filter: blur(8px) saturate(130%);
      box-shadow:
        0 12px 24px rgba(173, 188, 244, 0.25),
        inset 0 1px 0 rgba(255, 255, 255, 0.25);
    }
      .btn-sm {
    padding: 4px 10px;
    font-size: 12px;
    border-radius: 10px;
    opacity: .95;          /* nổi hơn trên nền glass */
  }

    .btn::after {
      /* highlight gợn kính */
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: radial-gradient(120% 80% at 30% -10%,
        rgba(255,255,255,0.45), rgba(255,255,255,0.0) 45%);
      pointer-events: none;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow:
        0 16px 30px rgba(212, 192, 249, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
    }
    .btn:active { transform: translateY(0); }

    .btn-outline {
      background: transparent;
      border: 1px solid #334155;
      color: #e5e7eb;
      border-radius: 8px;
      padding: 6px 10px;
      cursor: pointer
    }

    table {
      width: 100%;
      border-collapse: collapse
    }

    th,
    td {
      padding: 10px;
      border-bottom: 1px solid #1f2937;
      text-align: left
    }

    .code {
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      border: 1px solid #1f2937;
      padding: 2px 6px;
      border-radius: 6px
    }

    .status {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 12px
    }

    .on {
      background: #065f46
    }

    .off {
      background: #4b5563
    }

    .muted {
      color: var(--muted)
    }

    .link {
      color: #93c5fd;
      text-decoration: none;
    }
    /* ===== Autocomplete style giống index ===== */
    .sugg-wrap { position: relative; flex: 0 0 30%; min-width: 260px }
    .sugg-input { width: 100%; background: #0b1220; color: var(--txt); border: 1px solid #243045; border-radius: 10px; padding: 10px 12px; outline: none }
    .sugg-list {
      position: absolute; top: calc(100% + 6px); left: 0; right: 0; z-index: 30;
      background: var(--card); border: 1px solid #1f2937; border-radius: 12px;
      box-shadow: 0 10px 24px rgba(0,0,0,.35); overflow: hidden; display: none;
      max-height: 320px; overflow-y: auto;
    }
    .sugg-item { display: flex; align-items: center; gap: 0px; padding: 10px 12px; cursor: pointer; color: var(--txt); border-bottom: 1px solid #1f2937 }
    .sugg-item:last-child { border-bottom: 0 }
    .sugg-item:hover, .sugg-item.is-active { background: #0b1220 }
    /* Ẩn vòng tròn màu cam */
    .sugg-badge { 
      display: none; 
    }
    .sugg-name { flex: 1 }
    .sugg-status { font-size: 12px; color: var(--muted) }
    .sugg-empty { padding: 10px 12px; color: var(--muted) }
    /* ===== Toggle switch (slider) ===== */
.switch {
  position: relative; display: inline-block;
  width: 46px; height: 26px; vertical-align: middle;
}
.switch input { display: none; }
.slider {
  position: absolute; inset: 0; cursor: pointer;
  background: #374151; border-radius: 999px; transition: background .2s ease;
}
.slider:before {
  content: ""; position: absolute; height: 20px; width: 20px; left: 3px; top: 3px;
  background: white; border-radius: 50%; transition: transform .2s ease;
}
.switch input:checked + .slider { background: #10b981; }
.switch input:checked + .slider:before { transform: translateX(20px); }

/* ===== Confirm Modal (glass) – giống file chấm điểm ===== */
.modal-overlay {
  position: fixed; inset: 0; z-index: 1000; background: rgba(0,0,0,.45);
  display: none; align-items: center; justify-content: center;
}
.modal {
  width: min(520px, 92vw);
  background: rgba(17, 24, 39, 0.30);
  border: 1px solid rgba(255,255,255,0.18);
  border-radius: 16px; padding: 16px; color: #e5e7eb;
  -webkit-backdrop-filter: blur(14px) saturate(120%);
  backdrop-filter: blur(14px) saturate(120%);
  box-shadow: 0 12px 30px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.06);
}
.modal h4 { margin: 0 0 8px; font-size: 18px; }
.modal p { margin: 0 0 14px; color: #cbd5e1; }
.modal-actions { display: flex; gap: 10px; justify-content: flex-end; }

  </style>
{% endblock %}

{% block content %}
  <div class="container">
    <h1 class="page-title">Danh sách Cuộc thi</h1>
    <div style="margin-bottom:12px">
      <a class="link" href="/" style="color:#edf0f3">← Về trang chủ</a>
    </div>

    {% if messages %}
    {% for m in messages %}<div style="margin:6px 0">{{ m }}</div>{% endfor %}
    {% endif %}
    <!-- Nút hiển thị form tạo (không cần card) -->
    <div style="display:flex;align-items:center;gap:10px;margin:8px 0 12px 0">
      <button id="btn-show-create" type="button" class="btn">+ Tạo cuộc thi</button>
    </div>



    <div id="create-card" class="card" style="display:none">
      <h3 style="margin:0 0 10px">Thêm Cuộc thi</h3>
      <form id="create-form" method="post" class="row">
        {% csrf_token %}
        <input type="hidden" name="action" value="create">
        <input type="text" name="tenCuocThi" placeholder="Tên cuộc thi" required style="min-width:280px">
        <label>Trạng thái</label>
        <label style="display:flex;align-items:center;gap:6px">
          <input type="checkbox" name="trangThai"> Bật
        </label>
        <button class="btn" type="submit">Tạo</button>
      </form>
    </div>
    <div style="display:flex; align-items:center; gap:12px; margin-bottom:8px">
      <h3 style="margin:0">Danh sách</h3>
      <div class="sugg-wrap">
        <input id="search-ct" type="text" class="sugg-input" placeholder="Tìm kiếm cuộc thi theo tên…">
        <div id="ct-suggest" class="sugg-list"></div>
      </div>
    </div>

    <div class="card">

      {% if items %}
      <table>
        <thead>
          <tr>
            <th style="width:120px">Mã</th>
            <th>Tên cuộc thi</th>
            <th style="width:120px">Trạng thái</th>
            <th style="width:280px">Hành động</th>
          </tr>
        </thead>
        <tbody>
          {% for ct in items %}
          <tr>
            <td><span class="code">{{ ct.ma }}</span></td>
            <td>
              <form method="post" class="row js-update-form" style="gap:6px">
                {% csrf_token %}
                <input type="hidden" name="action" value="update">
                <input type="hidden" name="id" value="{{ ct.id }}">
                <input type="text" name="tenCuocThi" value="{{ ct.tenCuocThi }}" style="min-width:280px" data-init="{{ ct.tenCuocThi|escapejs }}">
                <label style="display:flex;align-items:center;gap:6px">
                  <span>Bật</span>
                  <label class="switch" title="Bật/tắt">
                    <input type="checkbox"
                          name="trangThai"
                          {% if ct.trangThai %}checked{% endif %}
                          data-init="{% if ct.trangThai %}1{% else %}0{% endif %}">
                    <span class="slider"></span>
                  </label>
                </label>
              </form>
            </td>
            <td>
              <span class="status {{ ct.trangThai|yesno:'on,off' }}">
                <span class="dot"></span>
                {{ ct.trangThai|yesno:"Đang bật,Đang tắt" }}
              </span>

            </td>
            <td>
              <form method="post" onsubmit="return confirm('Xoá cuộc thi {{ ct.ma }}?');" style="display:inline-block">
                {% csrf_token %}
                <input type="hidden" name="action" value="delete">
                <input type="hidden" name="id" value="{{ ct.id }}">
                <button class="btn-outline" type="submit">Xoá</button>
              </form>
              <a class="btn-outline" href="{% url 'organize-detail' ct.id %}">Chi tiết (thêm Vòng/Bài)</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <div class="muted">Chưa có cuộc thi nào.</div>
      {% endif %}


    </div>
  </div>
<div id="confirmModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
  <div class="modal">
    <h4 id="confirmTitle">Xác nhận</h4>
    <p id="confirmMessage">Bạn có chắc chắn?</p>
    <div class="modal-actions">
      <button id="confirmCancel" class="btn" type="button">Hủy</button>
      <button id="confirmOk" class="btn" type="button">Đồng ý</button>
    </div>
  </div>
</div>

<script src="{% static 'core/organize.js' %}?v={% now 'U' %}" defer></script>

{% endblock %}