{% extends "base.html" %}
{% load static %}
{% block title %}Danh sách cuộc thi{% endblock %}


{% block head_extra %}
  <meta charset="utf-8">
  <title>Quản lý Cuộc thi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --bg: #0f172a;
      --card: #111827;
      --muted: #94a3b8;
      --txt: #e5e7eb;
      --brand: #f59e0b;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--txt);
      font-family: system-ui, Segoe UI, Roboto, Inter, Arial
    }

    .container {
      max-width: 960px;
      margin: 24px auto;
      padding: 0 16px
    }

    h1 {
      margin: 0 0 16px;
      font-size: 32px;
      font-weight: 800;
      margin: 0 0 16px;
    }

    .page-title {
      font-size: 32px !important;
      font-weight: 600 !important;
      line-height: 1.2;
      margin: 0 0 16px;
    }
/* Liquid glass card */
.card {
  position: relative;
  border-radius: 16px;
  padding: 16px;
  margin-bottom: 16px;

  background: linear-gradient( to bottom right, rgba(255,255,255,0.1), rgba(255,255,255,0.06) );
  border: 1px solid rgba(255,255,255,0.14);
  box-shadow:
    0 10px 30px rgba(0,0,0,0.35),
    inset 0 1px 0 rgba(255,255,255,0.08);

  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
}

.card::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  pointer-events: none;
  background:
    radial-gradient(120% 120% at -10% -20%, rgba(255,255,255,0.20), transparent 45%),
    radial-gradient(110% 110% at 120% -10%, rgba(255,255,255,0.12), transparent 45%);
  mix-blend-mode: screen;
  opacity: .7;
}


    .row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center
    }

    input[type=text],
    input[type=number] {
      background: #0b1220;
      color: var(--txt);
      border: 1px solid #243045;
      border-radius: 8px;
      padding: 8px 10px
    }

    .btn {
      background: var(--brand);
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      color: #111827;
      font-weight: 600;
      cursor: pointer
    }

    .btn-outline {
      background: transparent;
      border: 1px solid #334155;
      color: #e5e7eb;
      border-radius: 8px;
      padding: 6px 10px;
      cursor: pointer
    }

    table {
      width: 100%;
      border-collapse: collapse
    }

    th,
    td {
      padding: 10px;
      border-bottom: 1px solid #1f2937;
      text-align: left
    }

    .code {
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      border: 1px solid #1f2937;
      padding: 2px 6px;
      border-radius: 6px
    }

    .status {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 12px
    }

    .on {
      background: #065f46
    }

    .off {
      background: #4b5563
    }

    .muted {
      color: var(--muted)
    }

    .link {
      color: #93c5fd;
      text-decoration: none;
    }
    /* ===== Autocomplete style giống index ===== */
    .sugg-wrap { position: relative; flex: 0 0 30%; min-width: 260px }
    .sugg-input { width: 100%; background: #0b1220; color: var(--txt); border: 1px solid #243045; border-radius: 10px; padding: 10px 12px; outline: none }
    .sugg-list {
      position: absolute; top: calc(100% + 6px); left: 0; right: 0; z-index: 30;
      background: var(--card); border: 1px solid #1f2937; border-radius: 12px;
      box-shadow: 0 10px 24px rgba(0,0,0,.35); overflow: hidden; display: none;
      max-height: 320px; overflow-y: auto;
    }
    .sugg-item { display: flex; align-items: center; gap: 0px; padding: 10px 12px; cursor: pointer; color: var(--txt); border-bottom: 1px solid #1f2937 }
    .sugg-item:last-child { border-bottom: 0 }
    .sugg-item:hover, .sugg-item.is-active { background: #0b1220 }
    /* Ẩn vòng tròn màu cam */
    .sugg-badge { 
      display: none; 
    }
    .sugg-name { flex: 1 }
    .sugg-status { font-size: 12px; color: var(--muted) }
    .sugg-empty { padding: 10px 12px; color: var(--muted) }
  </style>
{% endblock %}

{% block content %}
  <div class="container">
    <h1 class="page-title">Danh sách Cuộc thi</h1>
    <div style="margin-bottom:12px">
      <a class="link" href="/" style="color:#edf0f3">← Về trang chủ</a>
    </div>

    {% if messages %}
    {% for m in messages %}<div style="margin:6px 0">{{ m }}</div>{% endfor %}
    {% endif %}
    <!-- Nút hiển thị form tạo (không cần card) -->
    <div style="display:flex;align-items:center;gap:10px;margin:8px 0 12px 0">
      <button id="btn-show-create" type="button" class="btn">+ Tạo cuộc thi</button>
    </div>



    <div id="create-card" class="card" style="display:none">
      <h3 style="margin:0 0 10px">Thêm Cuộc thi</h3>
      <form method="post" class="row">
        {% csrf_token %}
        <input type="hidden" name="action" value="create">
        <input type="text" name="tenCuocThi" placeholder="Tên cuộc thi" required style="min-width:280px">
                    <label>Trạng thái</label>
                    <label style="display:flex;align-items:center;gap:6px">
                        <input type="checkbox" name="trangThai"> Bật
                    </label>
        <button class="btn" type="submit">Tạo</button>
      </form>
    </div>
    <div style="display:flex; align-items:center; gap:12px; margin-bottom:8px">
      <h3 style="margin:0">Danh sách</h3>
      <div class="sugg-wrap">
        <input id="search-ct" type="text" class="sugg-input" placeholder="Tìm kiếm cuộc thi theo tên…">
        <div id="ct-suggest" class="sugg-list"></div>
      </div>
    </div>

    <div class="card">

      {% if items %}
      <table>
        <thead>
          <tr>
            <th style="width:120px">Mã</th>
            <th>Tên cuộc thi</th>
            <th style="width:120px">Trạng thái</th>
            <th style="width:280px">Hành động</th>
          </tr>
        </thead>
        <tbody>
          {% for ct in items %}
          <tr>
            <td><span class="code">{{ ct.ma }}</span></td>
            <td>
              <form method="post" class="row" style="gap:6px">
                {% csrf_token %}
                <input type="hidden" name="action" value="update">
                <input type="hidden" name="id" value="{{ ct.id }}">
                <input type="text" name="tenCuocThi" value="{{ ct.tenCuocThi }}" style="min-width:280px">
                <label style="display:flex;align-items:center;gap:6px">
                  <input type="checkbox" name="trangThai" {% if ct.trangThai %}checked{% endif %}> Bật
                </label>
                <button class="btn" type="submit">Lưu</button>
              </form>
            </td>
            <td>
              <span class="status {{ ct.trangThai|yesno:'on,off' }}">
                <span class="dot"></span>
                {{ ct.trangThai|yesno:"Đang bật,Đang tắt" }}
              </span>

            </td>
            <td>
              <form method="post" onsubmit="return confirm('Xoá cuộc thi {{ ct.ma }}?');" style="display:inline-block">
                {% csrf_token %}
                <input type="hidden" name="action" value="delete">
                <input type="hidden" name="id" value="{{ ct.id }}">
                <button class="btn-outline" type="submit">Xoá</button>
              </form>
              <a class="btn-outline" href="{% url 'organize-detail' ct.id %}">Chi tiết (thêm Vòng/Bài)</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <div class="muted">Chưa có cuộc thi nào.</div>
      {% endif %}
    </div>
  </div>
  <script src="{% static 'core/organize.js' %}" defer></script>

{% endblock %}