{% load static %}
<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Quản lý Cuộc thi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{--bg:#0f172a;--card:#111827;--muted:#94a3b8;--txt:#e5e7eb;--brand:#f59e0b;}
    body{margin:0;background:var(--bg);color:var(--txt);font-family:system-ui,Segoe UI,Roboto,Inter,Arial}
    .container{max-width:960px;margin:24px auto;padding:0 16px}
    h1{font-size:24px;margin:0 0 16px}
    .card{background:var(--card);border-radius:12px;padding:16px;border:1px solid #1f2937;margin-bottom:16px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    input[type=text], input[type=number]{background:#0b1220;color:var(--txt);border:1px solid #243045;border-radius:8px;padding:8px 10px}
    .btn{background:var(--brand);border:none;border-radius:8px;padding:8px 12px;color:#111827;font-weight:600;cursor:pointer}
    .btn-outline{background:transparent;border:1px solid #334155;color:#e5e7eb;border-radius:8px;padding:6px 10px;cursor:pointer}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid #1f2937;text-align:left}
    .code{font-family:ui-monospace, SFMono-Regular, Menlo, monospace; background:#0b1220;border:1px solid #1f2937;padding:2px 6px;border-radius:6px}
    .status{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px}
    .on{background:#065f46} .off{background:#4b5563}
    .muted{color:var(--muted)}
    .link{color:#93c5fd;text-decoration:none}
  </style>
</head>
<body>
  <div class="container">
    <h1>Quản lý Cuộc thi</h1>
    <div style="margin-bottom:8px">
      <a class="link" href="/organize/">← Về trang Tổ chức</a>
    </div>

    {% if messages %}
      {% for m in messages %}<div style="margin:6px 0">{{ m }}</div>{% endfor %}
    {% endif %}

    <div class="card">
      <h3 style="margin:0 0 10px">Thêm Cuộc thi</h3>
      <form method="post" class="row">
        {% csrf_token %}
        <input type="hidden" name="action" value="create">
        <input type="text" name="tenCuocThi" placeholder="Tên cuộc thi" required style="min-width:280px">
        <label style="display:flex;align-items:center;gap:6px">
          <input type="checkbox" name="trangThai"> Bật
        </label>
        <button class="btn" type="submit">Tạo</button>
      </form>
    </div>

    <div class="card">
      <h3 style="margin:0 0 10px">Danh sách</h3>
      {% if items %}
      <table>
        <thead>
          <tr>
            <th style="width:120px">Mã</th>
            <th>Tên cuộc thi</th>
            <th style="width:120px">Trạng thái</th>
            <th style="width:220px">Hành động</th>
          </tr>
        </thead>
        <tbody>
          {% for ct in items %}
          <tr>
            <td><span class="code">{{ ct.ma }}</span></td>
            <td>
              <form method="post" class="row" style="gap:6px">
                {% csrf_token %}
                <input type="hidden" name="action" value="update">
                <input type="hidden" name="id" value="{{ ct.id }}">
                <input type="text" name="tenCuocThi" value="{{ ct.tenCuocThi }}" style="min-width:280px">
                <label style="display:flex;align-items:center;gap:6px">
                  <input type="checkbox" name="trangThai" {% if ct.trangThai %}checked{% endif %}> Bật
                </label>
                <button class="btn" type="submit">Lưu</button>
              </form>
            </td>
            <td>
              <span class="status {{ ct.trangThai|yesno:'on,off' }}">
  <span class="dot"></span>
  {{ ct.trangThai|yesno:"Đang bật,Đang tắt" }}
</span>

            </td>
            <td>
              <form method="post" onsubmit="return confirm('Xoá cuộc thi {{ ct.ma }}?');" style="display:inline-block">
                {% csrf_token %}
                <input type="hidden" name="action" value="delete">
                <input type="hidden" name="id" value="{{ ct.id }}">
                <button class="btn-outline" type="submit">Xoá</button>
              </form>
              <a class="btn-outline" href="/organize/">Chi tiết (thêm Vòng/Bài)</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
        <div class="muted">Chưa có cuộc thi nào.</div>
      {% endif %}
    </div>
  </div>
</body>
</html>
